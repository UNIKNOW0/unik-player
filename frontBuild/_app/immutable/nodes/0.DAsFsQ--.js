import"../chunks/DsnmJJEf.js";import"../chunks/3zk_imzF.js";import{o as nt}from"../chunks/BZQsIamB.js";import{h as st,a as ot,ad as H,G as at,aX as ut,aY as lt,z as et,x as ht,y as Q,H as ct,I as gt,J as mt,l as ft,A as dt}from"../chunks/Cvfl7IPK.js";import{i as bt,s as _t,a as wt}from"../chunks/B-_gdPEx.js";import{i as vt}from"../chunks/CtKCt-92.js";import{a as G,b as Y,t as N,S as J}from"../chunks/19QLxOdz.js";import{s as xt}from"../chunks/C5xdAr-S.js";function pt(r,t,e,i,s){st&&ot();var n=t.$$slots?.[e],o=!1;n===!0&&(n=t.children,o=!0),n===void 0||n(r,o?()=>i:i)}class Lt{constructor(t,e){this.pixels=t,this.opts=e;const{sigBits:i}=e,s=(v,M,f)=>(v<<2*i)+(M<<i)+f;this.getColorIndex=s;const n=8-i,o=1<<3*i,a=new Uint32Array(o);let u,l,h,g,d,_,c,m,b,V;u=h=d=0,l=g=_=Number.MAX_VALUE;const L=t.length/4;let P=0;for(;P<L;){const v=P*4;if(P++,c=t[v+0],m=t[v+1],b=t[v+2],V=t[v+3],V===0)continue;c=c>>n,m=m>>n,b=b>>n;const M=s(c,m,b);a[M]===void 0&&(a[M]=0),a[M]+=1,c>u&&(u=c),c<l&&(l=c),m>h&&(h=m),m<g&&(g=m),b>d&&(d=b),b<_&&(_=b)}this._colorCount=a.reduce((v,M)=>M>0?v+1:v,0),this.hist=a,this.rmax=u,this.rmin=l,this.gmax=h,this.gmin=g,this.bmax=d,this.bmin=_}get colorCount(){return this._colorCount}}class yt{scaleDown(t){const e=this.getWidth(),i=this.getHeight();let s=1;if(t.maxDimension>0){const n=Math.max(e,i);n>t.maxDimension&&(s=t.maxDimension/n)}else s=1/t.quality;s<1&&this.resize(e*s,i*s,s)}}function Ct(r,t){var e;if(t.length>0){const i=r.data,s=i.length/4;let n,o,a,u,l;for(let h=0;h<s;h++){n=h*4,o=i[n+0],a=i[n+1],u=i[n+2],l=i[n+3];for(let g=0;g<t.length;g++)if(!((e=t[g])!=null&&e.call(t,o,a,u,l))){i[n+3]=0;break}}}return r}function Vt(r){const t=new URL(r,location.href);return t.protocol===location.protocol&&t.host===location.host&&t.port===location.port}function Mt(r,t){const e=new URL(r),i=new URL(t);return e.protocol===i.protocol&&e.hostname===i.hostname&&e.port===i.port}class Dt extends yt{_getCanvas(){if(!this._canvas)throw new Error("Canvas is not initialized");return this._canvas}_getContext(){if(!this._context)throw new Error("Context is not initialized");return this._context}_getWidth(){if(!this._width)throw new Error("Width is not initialized");return this._width}_getHeight(){if(!this._height)throw new Error("Height is not initialized");return this._height}_initCanvas(){const t=this.image;if(!t)throw new Error("Image is not initialized");const e=this._canvas=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new ReferenceError("Failed to create canvas context");this._context=i,e.className="@vibrant/canvas",e.style.display="none",this._width=e.width=t.width,this._height=e.height=t.height,i.drawImage(t,0,0),document.body.appendChild(e)}load(t){let e,i;if(typeof t=="string")e=document.createElement("img"),i=t,!Vt(i)&&!Mt(window.location.href,i)&&(e.crossOrigin="anonymous"),e.src=i;else if(t instanceof HTMLImageElement)e=t,i=t.src;else return Promise.reject(new Error("Cannot load buffer as an image in browser"));return this.image=e,new Promise((s,n)=>{const o=()=>{this._initCanvas(),s(this)};e.complete?o():(e.onload=o,e.onerror=a=>n(new Error(`Fail to load image: ${i}`)))})}clear(){this._getContext().clearRect(0,0,this._getWidth(),this._getHeight())}update(t){this._getContext().putImageData(t,0,0)}getWidth(){return this._getWidth()}getHeight(){return this._getHeight()}resize(t,e,i){if(!this.image)throw new Error("Image is not initialized");this._width=this._getCanvas().width=t,this._height=this._getCanvas().height=e,this._getContext().scale(i,i),this._getContext().drawImage(this.image,0,0)}getPixelCount(){return this._getWidth()*this._getHeight()}getImageData(){return this._getContext().getImageData(0,0,this._getWidth(),this._getHeight())}remove(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}}function T(r,...t){return t.forEach(e=>{if(e){for(const i in e)if(e.hasOwnProperty(i)){const s=e[i];Array.isArray(s)?r[i]=s.slice(0):typeof s=="object"?(r[i]||(r[i]={}),T(r[i],s)):r[i]=s}}}),r}function kt(r,t){const{colorCount:e,quantizer:i,generators:s,filters:n}=r,o={colorCount:e},a=typeof i=="string"?{name:i,options:{}}:i;return a.options=T({},o,a.options),T({},{quantizer:a,generators:s,filters:n},t)}class St{constructor(t,e={}){this._src=t,this._opts=T({},S.DefaultOpts,e)}maxColorCount(t){return this._opts.colorCount=t,this}maxDimension(t){return this._opts.maxDimension=t,this}addFilter(t){return this._opts.filters?this._opts.filters.push(t):this._opts.filters=[t],this}removeFilter(t){if(this._opts.filters){const e=this._opts.filters.indexOf(t);e>0&&this._opts.filters.splice(e)}return this}clearFilters(){return this._opts.filters=[],this}quality(t){return this._opts.quality=t,this}useImageClass(t){return this._opts.ImageClass=t,this}useGenerator(t,e){return this._opts.generators||(this._opts.generators=[]),this._opts.generators.push(e?{name:t,options:e}:t),this}useQuantizer(t,e){return this._opts.quantizer=e?{name:t,options:e}:t,this}build(){return new S(this._src,this._opts)}getPalette(){return this.build().getPalette()}}class j{constructor(t){this.pipeline=t,this._map={}}names(){return Object.keys(this._map)}has(t){return!!this._map[t]}get(t){return this._map[t]}register(t,e){return this._map[t]=e,this.pipeline}}class Pt{constructor(){this.filter=new j(this),this.quantizer=new j(this),this.generator=new j(this)}_buildProcessTasks({filters:t,quantizer:e,generators:i}){return i.length===1&&i[0]==="*"&&(i=this.generator.names()),{filters:t.map(n=>s(this.filter,n)),quantizer:s(this.quantizer,e),generators:i.map(n=>s(this.generator,n))};function s(n,o){let a,u;return typeof o=="string"?a=o:(a=o.name,u=o.options),{name:a,fn:n.get(a),options:u}}}async process(t,e){const{filters:i,quantizer:s,generators:n}=this._buildProcessTasks(e),o=await this._filterColors(i,t),a=await this._generateColors(s,o),u=await this._generatePalettes(n,a);return{colors:a,palettes:u}}_filterColors(t,e){return Promise.resolve(Ct(e,t.map(({fn:i})=>i)))}_generateColors(t,e){return Promise.resolve(t.fn(e.data,t.options))}async _generatePalettes(t,e){const i=await Promise.all(t.map(({fn:s,options:n})=>Promise.resolve(s(e,n))));return Promise.resolve(i.reduce((s,n,o)=>(s[t[o].name]=n,s),{}))}}function zt(r,t,e){return"#"+((1<<24)+(r<<16)+(t<<8)+e).toString(16).slice(1,7)}function Et(r,t,e){r/=255,t/=255,e/=255;const i=Math.max(r,t,e),s=Math.min(r,t,e);let n=0,o=0;const a=(i+s)/2;if(i!==s){const u=i-s;switch(o=a>.5?u/(2-i-s):u/(i+s),i){case r:n=(t-e)/u+(t<e?6:0);break;case t:n=(e-r)/u+2;break;case e:n=(r-t)/u+4;break}n/=6}return[n,o,a]}function D(r,t,e){let i,s,n;function o(a,u,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?a+(u-a)*6*l:l<1/2?u:l<2/3?a+(u-a)*(2/3-l)*6:a}if(t===0)i=s=n=e;else{const a=e<.5?e*(1+t):e+t-e*t,u=2*e-a;i=o(u,a,r+1/3),s=o(u,a,r),n=o(u,a,r-1/3)}return[i*255,s*255,n*255]}class y{static applyFilters(t,e){return e.length>0?t.filter(({r:i,g:s,b:n})=>{var o;for(let a=0;a<e.length;a++)if(!((o=e[a])!=null&&o.call(e,i,s,n,255)))return!1;return!0}):t}static clone(t){return new y(t._rgb,t._population)}get r(){return this._rgb[0]}get g(){return this._rgb[1]}get b(){return this._rgb[2]}get rgb(){return this._rgb}get hsl(){if(!this._hsl){const[t,e,i]=this._rgb;this._hsl=Et(t,e,i)}return this._hsl}get hex(){if(!this._hex){const[t,e,i]=this._rgb;this._hex=zt(t,e,i)}return this._hex}get population(){return this._population}toJSON(){return{rgb:this.rgb,population:this.population}}getYiq(){if(!this._yiq){const t=this._rgb;this._yiq=(t[0]*299+t[1]*587+t[2]*114)/1e3}return this._yiq}get titleTextColor(){return this._titleTextColor||(this._titleTextColor=this.getYiq()<200?"#fff":"#000"),this._titleTextColor}get bodyTextColor(){return this._bodyTextColor||(this._bodyTextColor=this.getYiq()<150?"#fff":"#000"),this._bodyTextColor}constructor(t,e){this._rgb=t,this._population=e}}const it=class A{constructor(t,e){this._src=t,this.opts=T({},A.DefaultOpts,e)}static use(t){this._pipeline=t}static from(t){return new St(t)}get result(){return this._result}_process(t,e){t.scaleDown(this.opts);const i=kt(this.opts,e);return A._pipeline.process(t.getImageData(),i)}async getPalette(){const t=new this.opts.ImageClass;try{const e=await t.load(this._src),i=await this._process(e,{generators:["default"]});this._result=i;const s=i.palettes.default;if(!s)throw new Error("Something went wrong and a palette was not found, please file a bug against our GitHub repo: https://github.com/vibrant-Colors/node-vibrant/");return t.remove(),s}catch(e){return t.remove(),Promise.reject(e)}}async getPalettes(){const t=new this.opts.ImageClass;try{const e=await t.load(this._src),i=await this._process(e,{generators:["*"]});this._result=i;const s=i.palettes;return t.remove(),s}catch(e){return t.remove(),Promise.reject(e)}}};it.DefaultOpts={colorCount:64,quality:5,filters:[]};let S=it;S.DefaultOpts.quantizer="mmcq";S.DefaultOpts.generators=["default"];S.DefaultOpts.filters=["default"];S.DefaultOpts.ImageClass=Dt;const U=5,q=8-U;class O{constructor(t,e,i,s,n,o,a){this.histogram=a,this._volume=-1,this._avg=null,this._count=-1,this.dimension={r1:t,r2:e,g1:i,g2:s,b1:n,b2:o}}static build(t){const e=new Lt(t,{sigBits:U}),{rmin:i,rmax:s,gmin:n,gmax:o,bmin:a,bmax:u}=e;return new O(i,s,n,o,a,u,e)}invalidate(){this._volume=this._count=-1,this._avg=null}volume(){if(this._volume<0){const{r1:t,r2:e,g1:i,g2:s,b1:n,b2:o}=this.dimension;this._volume=(e-t+1)*(s-i+1)*(o-n+1)}return this._volume}count(){if(this._count<0){const{hist:t,getColorIndex:e}=this.histogram,{r1:i,r2:s,g1:n,g2:o,b1:a,b2:u}=this.dimension;let l=0;for(let h=i;h<=s;h++)for(let g=n;g<=o;g++)for(let d=a;d<=u;d++){const _=e(h,g,d);t[_]&&(l+=t[_])}this._count=l}return this._count}clone(){const{histogram:t}=this,{r1:e,r2:i,g1:s,g2:n,b1:o,b2:a}=this.dimension;return new O(e,i,s,n,o,a,t)}avg(){if(!this._avg){const{hist:t,getColorIndex:e}=this.histogram,{r1:i,r2:s,g1:n,g2:o,b1:a,b2:u}=this.dimension;let l=0;const h=1<<8-U;let g,d,_;g=d=_=0;for(let c=i;c<=s;c++)for(let m=n;m<=o;m++)for(let b=a;b<=u;b++){const V=e(c,m,b),L=t[V];L&&(l+=L,g+=L*(c+.5)*h,d+=L*(m+.5)*h,_+=L*(b+.5)*h)}l?this._avg=[~~(g/l),~~(d/l),~~(_/l)]:this._avg=[~~(h*(i+s+1)/2),~~(h*(n+o+1)/2),~~(h*(a+u+1)/2)]}return this._avg}contains(t){let[e,i,s]=t;const{r1:n,r2:o,g1:a,g2:u,b1:l,b2:h}=this.dimension;return e>>=q,i>>=q,s>>=q,e>=n&&e<=o&&i>=a&&i<=u&&s>=l&&s<=h}split(){const{hist:t,getColorIndex:e}=this.histogram,{r1:i,r2:s,g1:n,g2:o,b1:a,b2:u}=this.dimension,l=this.count();if(!l)return[];if(l===1)return[this.clone()];const h=s-i+1,g=o-n+1,d=u-a+1,_=Math.max(h,g,d);let c=null,m,b;m=b=0;let V=null;if(_===h){V="r",c=new Uint32Array(s+1);for(let f=i;f<=s;f++){m=0;for(let w=n;w<=o;w++)for(let x=a;x<=u;x++){const C=e(f,w,x);t[C]&&(m+=t[C])}b+=m,c[f]=b}}else if(_===g){V="g",c=new Uint32Array(o+1);for(let f=n;f<=o;f++){m=0;for(let w=i;w<=s;w++)for(let x=a;x<=u;x++){const C=e(w,f,x);t[C]&&(m+=t[C])}b+=m,c[f]=b}}else{V="b",c=new Uint32Array(u+1);for(let f=a;f<=u;f++){m=0;for(let w=i;w<=s;w++)for(let x=n;x<=o;x++){const C=e(w,x,f);t[C]&&(m+=t[C])}b+=m,c[f]=b}}let L=-1;const P=new Uint32Array(c.length);for(let f=0;f<c.length;f++){const w=c[f];w&&(L<0&&w>b/2&&(L=f),P[f]=b-w)}const v=this;function M(f){const w=f+"1",x=f+"2",C=v.dimension[w];let p=v.dimension[x];const W=v.clone(),$=v.clone(),R=L-C,B=p-L;for(R<=B?(p=Math.min(p-1,~~(L+B/2)),p=Math.max(0,p)):(p=Math.max(C,~~(L-1-R/2)),p=Math.min(v.dimension[x],p));!c[p];)p++;let F=P[p];for(;!F&&c[p-1];)F=P[--p];return W.dimension[x]=p,$.dimension[w]=p+1,[W,$]}return M(V)}}class X{_sort(){this._sorted||(this.contents.sort(this._comparator),this._sorted=!0)}constructor(t){this._comparator=t,this.contents=[],this._sorted=!1}push(t){this.contents.push(t),this._sorted=!1}peek(t){return this._sort(),t=typeof t=="number"?t:this.contents.length-1,this.contents[t]}pop(){return this._sort(),this.contents.pop()}size(){return this.contents.length}map(t){return this._sort(),this.contents.map(t)}}const It=.75;function K(r,t){let e=r.size();for(;r.size()<t;){const i=r.pop();if(i&&i.count()>0){const[s,n]=i.split();if(!s||(r.push(s),n&&n.count()>0&&r.push(n),r.size()===e))break;e=r.size()}else break}}const Tt=(r,t)=>{if(r.length===0||t.colorCount<2||t.colorCount>256)throw new Error("Wrong MMCQ parameters");const e=O.build(r);e.histogram.colorCount;const i=new X((n,o)=>n.count()-o.count());i.push(e),K(i,It*t.colorCount);const s=new X((n,o)=>n.count()*n.volume()-o.count()*o.volume());return s.contents=i.contents,K(s,t.colorCount-s.size()),Ot(s)};function Ot(r){const t=[];for(;r.size();){const e=r.pop(),i=e.avg();t.push(new y(i,e.count()))}return t}const Ht={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function Nt(r){let t=0;return r.forEach(e=>{t=Math.max(t,e.population)}),t}function jt(r,t){return r.Vibrant===t||r.DarkVibrant===t||r.LightVibrant===t||r.Muted===t||r.DarkMuted===t||r.LightMuted===t}function qt(r,t,e,i,s,n,o){function a(...l){let h=0,g=0;for(let d=0;d<l.length;d+=2){const _=l[d],c=l[d+1];!_||!c||(h+=_*c,g+=c)}return h/g}function u(l,h){return 1-Math.abs(l-h)}return a(u(r,t),o.weightSaturation,u(e,i),o.weightLuma,s/n,o.weightPopulation)}function z(r,t,e,i,s,n,o,a,u,l){let h=null,g=0;return t.forEach(d=>{const[,_,c]=d.hsl;if(_>=a&&_<=u&&c>=s&&c<=n&&!jt(r,d)){const m=qt(_,o,c,i,d.population,e,l);(h===null||m>g)&&(h=d,g=m)}}),h}function At(r,t,e){const i={Vibrant:null,DarkVibrant:null,LightVibrant:null,Muted:null,DarkMuted:null,LightMuted:null};return i.Vibrant=z(i,r,t,e.targetNormalLuma,e.minNormalLuma,e.maxNormalLuma,e.targetVibrantSaturation,e.minVibrantSaturation,1,e),i.LightVibrant=z(i,r,t,e.targetLightLuma,e.minLightLuma,1,e.targetVibrantSaturation,e.minVibrantSaturation,1,e),i.DarkVibrant=z(i,r,t,e.targetDarkLuma,0,e.maxDarkLuma,e.targetVibrantSaturation,e.minVibrantSaturation,1,e),i.Muted=z(i,r,t,e.targetNormalLuma,e.minNormalLuma,e.maxNormalLuma,e.targetMutesSaturation,0,e.maxMutesSaturation,e),i.LightMuted=z(i,r,t,e.targetLightLuma,e.minLightLuma,1,e.targetMutesSaturation,0,e.maxMutesSaturation,e),i.DarkMuted=z(i,r,t,e.targetDarkLuma,0,e.maxDarkLuma,e.targetMutesSaturation,0,e.maxMutesSaturation,e),i}function Ut(r,t,e){if(!r.Vibrant&&!r.DarkVibrant&&!r.LightVibrant){if(!r.DarkVibrant&&r.DarkMuted){let[i,s,n]=r.DarkMuted.hsl;n=e.targetDarkLuma,r.DarkVibrant=new y(D(i,s,n),0)}if(!r.LightVibrant&&r.LightMuted){let[i,s,n]=r.LightMuted.hsl;n=e.targetDarkLuma,r.DarkVibrant=new y(D(i,s,n),0)}}if(!r.Vibrant&&r.DarkVibrant){let[i,s,n]=r.DarkVibrant.hsl;n=e.targetNormalLuma,r.Vibrant=new y(D(i,s,n),0)}else if(!r.Vibrant&&r.LightVibrant){let[i,s,n]=r.LightVibrant.hsl;n=e.targetNormalLuma,r.Vibrant=new y(D(i,s,n),0)}if(!r.DarkVibrant&&r.Vibrant){let[i,s,n]=r.Vibrant.hsl;n=e.targetDarkLuma,r.DarkVibrant=new y(D(i,s,n),0)}if(!r.LightVibrant&&r.Vibrant){let[i,s,n]=r.Vibrant.hsl;n=e.targetLightLuma,r.LightVibrant=new y(D(i,s,n),0)}if(!r.Muted&&r.Vibrant){let[i,s,n]=r.Vibrant.hsl;n=e.targetMutesSaturation,r.Muted=new y(D(i,s,n),0)}if(!r.DarkMuted&&r.DarkVibrant){let[i,s,n]=r.DarkVibrant.hsl;n=e.targetMutesSaturation,r.DarkMuted=new y(D(i,s,n),0)}if(!r.LightMuted&&r.LightVibrant){let[i,s,n]=r.LightVibrant.hsl;n=e.targetMutesSaturation,r.LightMuted=new y(D(i,s,n),0)}}const Wt=(r,t)=>{t=Object.assign({},Ht,t);const e=Nt(r),i=At(r,e,t);return Ut(i,e,t),i},$t=new Pt().filter.register("default",(r,t,e,i)=>i>=125&&!(r>250&&t>250&&e>250)).quantizer.register("mmcq",Tt).generator.register("default",Wt);S.use($t);async function Z(r){document.documentElement.style.setProperty("--darkMuted",`rgb(${r.DarkMuted.rgb.join(",")})`),document.documentElement.style.setProperty("--vibrant",`rgb(${r.Vibrant.rgb.join(",")})`),document.documentElement.style.setProperty("--lightVibrant",`rgb(${r.LightVibrant.rgb.join(",")})`),document.documentElement.style.setProperty("--muted",`rgb(${r.Muted.rgb.join(",")})`),document.documentElement.style.setProperty("--darkVibrant",`rgb(${r.DarkVibrant.rgb.join(",")})`),document.documentElement.style.setProperty("--lightMuted",`rgb(${r.LightMuted.rgb.join(",")})`)}const tt=""+new URL("../assets/background.C3ghMAkQ.gif",import.meta.url).href;let k=null,E,I=1e3;function rt(){const r="ws://localhost:62727";E=new WebSocket(r),E.onopen=()=>{console.log("[WS] Connected"),I=1e3},E.onmessage=t=>{try{if(k=JSON.parse(t.data),console.log(k),k!=null){if(H(G)!=k.media.title&&G.set(k.media.title),H(Y)!=k.media.artist&&Y.set(k.media.artist),k.media.thumbnail!==void 0){const e=new Uint8Array(k.media.thumbnail.data),i=new Blob([e],{type:"image/png"});let s=URL.createObjectURL(i);H(N)!=s&&N.set(s),S.from(s).getPalette().then(n=>Z(n))}else N.set(tt),S.from(tt).getPalette().then(e=>Z(e));J.set(!0)}else J.set(!1)}catch(e){console.error("[WS] Parsing error",e)}},E.onerror=t=>{console.error("[WS] Error",t)},E.onclose=()=>{console.log("[WS] Closed, reconnect in",I,"ms"),setTimeout(rt,I),I=Math.min(I*2,3e4)}}const Rt=()=>{const r=xt;return{page:{subscribe:r.page.subscribe},navigating:{subscribe:r.navigating.subscribe},updated:r.updated}},Bt={subscribe(r){return Rt().page.subscribe(r)}};var Ft=et('<header class="svelte-1vf87mm"><a href="/" class="svelte-1vf87mm">Главная</a> <a href="/howToMake" class="svelte-1vf87mm">Как сделать <br/> свой дизайн</a></header>'),Qt=et("<!> <!>",1);function ie(r,t){at(t,!1);const[e,i]=_t(),s=()=>wt(Bt,"$page",e);let n=mt(!1);nt(()=>{rt()}),ut(()=>s(),()=>{gt(n,s().url.pathname!=="/player")}),lt(),vt();var o=Qt(),a=ht(o);{var u=h=>{var g=Ft();Q(h,g)};bt(a,h=>{ft(n)&&h(u)})}var l=dt(a,2);pt(l,t,"default",{}),Q(r,o),ct(),i()}export{ie as component};
